<div class="container py-5">
  <!-- Form Header -->
  <div class="text-center mb-5">
    <h2 class="display-5 fw-bold text-primary">
      <i class="bi bi-person-plus-fill me-2"></i>Create Your Account
    </h2>
    <p class="lead text-muted">
      Join our community and start your recovery journey today
    </p>
  </div>

  <!-- Registration Form -->
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <form [formGroup]="registerForm" (ngSubmit)="addUser()" class="card shadow-sm p-4" novalidate>
        <div class="row g-3">

          <!-- First Name -->
          <div class="col-md-6">
            <div class="form-floating">
              <input type="text"
                     class="form-control"
                     id="firstname"
                     formControlName="name"
                     placeholder="John"
                     autocomplete="given-name"
                     autofocus
                     [class.is-invalid]="shouldShowError('name')"
                     [class.is-valid]="name.valid && (name.dirty || name.touched)">
              <label for="firstname">First Name</label>
              @if (shouldShowError('name')) {
                <div class="invalid-feedback">
                  <i class="bi bi-exclamation-circle me-1"></i>
                  {{ getErrorMessage('name') }}
                </div>
              }
            </div>
          </div>

          <!-- Last Name -->
          <div class="col-md-6">
            <div class="form-floating">
              <input type="text"
                     class="form-control"
                     id="lastname"
                     formControlName="familyName"
                     placeholder="Smith"
                     autocomplete="family-name"
                     [class.is-invalid]="familyName.invalid && (familyName.dirty || familyName.touched)"
                     [class.is-valid]="familyName.valid && (familyName.dirty || familyName.touched)">
              <label for="lastname">Last Name</label>
              @if (shouldShowError('familyName')) {
                <div class="invalid-feedback">
                  <i class="bi bi-exclamation-circle me-1"></i>
                  {{ getErrorMessage('familyName') }}
                </div>
              }
            </div>
          </div>

          <!-- Email -->
          <div class="col-md-6">
            <div class="form-floating position-relative">
              <input type="email"
                     class="form-control"
                     id="email"
                     formControlName="email"
                     placeholder="Email address"
                     autocomplete="username"
                     [class.is-invalid]="email.invalid && (email.dirty || email.touched)"
                     [class.is-valid]="email.valid && (email.dirty || email.touched)">
              <label for="email">Email address</label>
              @if (email.invalid && (email.dirty || email.touched)) {
                <div class="invalid-feedback">
                  <i class="bi bi-exclamation-circle me-1"></i>
                  @if (email.errors?.['required']) {
                    <span>Email is required</span>
                  }
                  @if (email.errors?.['email'] || email.errors?.['pattern']) {
                    <span>Please enter a valid email</span>
                  }
                </div>
              }
            </div>
          </div>

          <!-- Password -->
          <div class="col-md-6">
            <div class="form-floating">
              <input [type]="passwordFieldType"
                     class="form-control pe-5"
                     id="password"
                     formControlName="password"
                     placeholder="Password"
                     [class.is-invalid]="shouldShowError('password')"
                     [class.is-valid]="password.valid && (password.dirty || password.touched)">
              <label for="password">Password</label>
              <button type="button"
                      class="btn btn-link position-absolute top-50 end-0 translate-middle-y me-3 p-0 border-0 bg-transparent password-toggle-btn"
                      style="z-index: 10; width: 24px; height: 24px; margin-top: -12px;"
                      aria-label="Toggle password visibility"
                      (click)="togglePasswordVisibility()">
                <i [class]="passwordIconClass" class="text-muted"></i>
              </button>
              @if (shouldShowError('password')) {
                <div class="invalid-feedback">
                  <i class="bi bi-exclamation-circle me-1"></i>
                  {{ getErrorMessage('password') }}
                </div>
              }
            </div>
          </div>

          <!-- Username -->
          <div class="col-md-6">
            <div class="form-floating position-relative">
              <input type="text"
                     class="form-control"
                     id="username"
                     formControlName="username"
                     placeholder="Username"
                     [class.is-invalid]="username.invalid && (username.dirty || username.touched)"
                     [class.is-valid]="username.valid && (username.dirty || username.touched)">
              <label for="username">Username</label>
              @if (shouldShowError('username')) {
                <div class="invalid-feedback">
                  <i class="bi bi-exclamation-circle me-1"></i>
                  {{ getErrorMessage('username') }}
                </div>
              }
            </div>
          </div>

          <!-- Birth Date -->
          <div class="col-md-6">
            <div class="form-floating">
              <input type="date"
                     class="form-control"
                     id="birthdate"
                     formControlName="dateOfBirth"
                     placeholder="Birth Date"
                     autocomplete="bday"
                     [attr.max]="maxBirthDate"
                     [class.is-invalid]="dateOfBirth.invalid && (dateOfBirth.dirty || dateOfBirth.touched)"
                     [class.is-valid]="dateOfBirth.valid && (dateOfBirth.dirty || dateOfBirth.touched)">

              <label for="birthdate">Birth Date</label>
              @if (dateOfBirth.invalid && (dateOfBirth.dirty || dateOfBirth.touched)) {
                <div class="invalid-feedback">
                  <i class="bi bi-exclamation-circle me-1"></i>
                  Please enter a valid birth date (must be 13+ years old)
                </div>
              }
            </div>
          </div>
        </div>

        <!-- Form Footer -->
        <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mt-4 pt-3 border-top gap-3">
          <div class="order-2 order-sm-1">
            <p class="mb-0 text-center text-sm-start">Already have an account?
              <a routerLink="/login" class="text-primary fw-semibold">Log in</a>
            </p>
          </div>
          <button type="submit"
                  class="btn btn-primary px-4 py-2 order-1 order-sm-2"
                  [disabled]="registerForm.invalid || isSubmitting">
            @if (!isSubmitting) {
              <span>Create Account</span>
            } @else {
              <span>
                <span class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
                Processing...
              </span>
            }
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
