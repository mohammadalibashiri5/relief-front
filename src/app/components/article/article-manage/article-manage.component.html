<div class="management-container">
  <app-header-management
    iconClass="bi-tags-fill"
    title="Article Management"
    description="Comprehensive management for articles based on categories">
  </app-header-management>

  <div class="management-content">
    <!-- Form Section -->
    <app-items-card iconClass="bi-plus-circle-dotted" title="Add New Article">
      <form [formGroup]="articleForm" (ngSubmit)="onSubmit()">
        <div class="form-group mb-3">
          <label for="title" class="form-label">Article Title *</label>
          <input
            type="text"
            id="title"
            formControlName="title"
            placeholder="Enter article title"
            class="form-control"
            [class.is-invalid]="articleForm.get('title')?.invalid && articleForm.get('title')?.touched"
          >
          <div *ngIf="articleForm.get('title')?.invalid && articleForm.get('title')?.touched" class="invalid-feedback">
            <div *ngIf="articleForm.get('title')?.errors?.['required']">Article title is required</div>
            <div *ngIf="articleForm.get('title')?.errors?.['minlength']">Minimum 5 characters required</div>
          </div>
        </div>

        <div class="form-group mb-3">
          <label for="imageUrl" class="form-label">Image URL *</label>
          <input
            type="url"
            id="imageUrl"
            formControlName="imageUrl"
            placeholder="https://example.com/image.jpg"
            class="form-control"
            [class.is-invalid]="articleForm.get('imageUrl')?.invalid && articleForm.get('imageUrl')?.touched"
          >
          <div *ngIf="articleForm.get('imageUrl')?.invalid && articleForm.get('imageUrl')?.touched" class="invalid-feedback">
            <div *ngIf="articleForm.get('imageUrl')?.errors?.['required']">Image URL is required</div>
            <div *ngIf="articleForm.get('imageUrl')?.errors?.['pattern']">Please enter a valid URL starting with https://</div>
          </div>

          <div *ngIf="articleForm.get('imageUrl')?.value" class="image-preview mt-3 text-center">
            <img
              [src]="articleForm.get('imageUrl')?.value"
              alt="Article preview"
              class="img-thumbnail"
              (error)="handleImageError($event)"
              style="max-height: 200px;">
            <small class="text-muted d-block mt-1">Image preview</small>
          </div>
        </div>

        <div class="form-group mb-3">
          <label for="category" class="form-label">Category *</label>
          <select
            class="form-select"
            id="category"
            formControlName="category"
            [class.is-invalid]="articleForm.get('category')?.invalid && articleForm.get('category')?.touched"
          >
            <option value="" disabled selected>Select a category</option>
            <option *ngFor="let cat of categories" [value]="cat">{{cat}}</option>
          </select>
          <div *ngIf="articleForm.get('category')?.invalid && articleForm.get('category')?.touched" class="invalid-feedback">
            Category selection is required
          </div>
        </div>

        <div class="form-group mb-3">
          <label for="content" class="form-label">Content *</label>
          <textarea
            id="content"
            formControlName="content"
            rows="10"
            placeholder="Write your article content here..."
            class="form-control"
            [class.is-invalid]="articleForm.get('content')?.invalid && articleForm.get('content')?.touched"
          ></textarea>
          <div *ngIf="articleForm.get('content')?.invalid && articleForm.get('content')?.touched" class="invalid-feedback">
            <div *ngIf="articleForm.get('content')?.errors?.['required']">Content is required</div>
            <div *ngIf="articleForm.get('content')?.errors?.['minlength']">Minimum 100 characters required</div>
          </div>
          <div class="text-end text-muted small mt-1">
            {{ articleForm.get('content')?.value?.length || 0 }}/5000 characters
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-submit" [disabled]="articleForm.invalid">
            <span>{{ articleId ? 'Update' : 'Add' }} Article</span>
            <i class="bi bi-arrow-right"></i>
          </button>
        </div>
      </form>
    </app-items-card>

    <!-- List Section -->
    <app-items-card iconClass="bi-collection-fill" title="Existing Articles">
      <div *ngIf="articles.length === 0" class="empty-state">
        <i class="bi bi-inbox"></i>
        <h4>No articles found</h4>
        <p>Start by adding your first article</p>
      </div>

      <div class="management-grid">
        <div *ngFor="let article of articles" class="grid-item-wrapper">
          <app-card-with-action
            [imageUrl]="article.imageUrl"
            [title]="article.title"
            [subtitle]="article.category"
            (edit)="onEditArticle(article)"
            (delete)="onDeleteArticle(article.id)">
          </app-card-with-action>
        </div>
      </div>
    </app-items-card>
  </div>
</div>
